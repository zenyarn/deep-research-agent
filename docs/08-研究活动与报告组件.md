# 研究活动与报告组件

本文档将指导你实现 Deep Research AI Agent 项目的研究活动跟踪和报告展示组件，这些组件让用户能够实时跟踪研究进度并查看最终报告。

## 步骤概览

1. 创建研究活动组件
2. 实现可折叠面板
3. 创建来源列表组件
4. 实现研究报告组件
5. 配置 Markdown 渲染
6. 添加报告下载功能

## 详细步骤与提示词

### 1. 创建研究活动组件

**提示词：**

```
请为 deep-research-ai-agent 项目创建研究活动组件 (ResearchActivities.tsx)，用于显示研究过程中的实时活动状态。

具体要求：
1. 创建 src/components/ui/deep-research/ResearchActivities.tsx 文件
2. 组件应从 Zustand store 获取活动列表和来源
3. 实现可折叠的活动面板，可在需要时折叠以节省空间
4. 使用标签系统区分活动和来源视图
5. 为不同状态的活动显示不同颜色标记：
   - pending: 黄色
   - complete: 绿色
   - error: 红色
   - warning: 橙色
6. 显示每个活动的时间戳，使用 date-fns 格式化

UI 设计要求：
- 活动面板应位于页面右上角，不干扰主内容
- 使用半透明背景和适当的阴影提高可读性
- 限制面板的最大高度，并添加滚动功能
- 提供折叠/展开按钮，以便用户控制显示

请提供完整的组件代码，包括折叠逻辑和样式。
```

**测试方法：**

- 使用模拟数据渲染组件，确认布局正确
- 测试折叠/展开功能
- 验证不同状态活动的颜色显示
- 确认时间戳格式化正确
- 检查标签切换功能是否正常工作

### 2. 实现可折叠面板组件

**提示词：**

```
请为研究活动组件实现可折叠面板功能。这将使用户能够在需要时查看活动，但不会占用过多屏幕空间。

具体要求：
1. 使用 Shadcn UI 的 Collapsible 组件实现可折叠功能
2. 实现以下功能：
   - 初始状态为展开（可以通过状态控制）
   - 提供明确的折叠/展开触发器
   - 平滑的折叠/展开动画
   - 在折叠状态下显示最小化指示器

3. 面板位置和样式：
   - 固定在屏幕右上角
   - 适当的 z-index，确保不被其他元素遮挡
   - 响应式设计，在移动设备上调整大小和位置

请更新 ResearchActivities.tsx 文件，添加这些可折叠功能。
```

**测试方法：**

- 测试折叠/展开交互
- 确认动画流畅
- 在不同屏幕尺寸下测试响应式行为
- 验证 z-index 设置是否正确（不被其他元素遮挡）

### 3. 创建标签系统和来源列表

**提示词：**

```
请为研究活动组件实现标签系统和来源列表。这将允许用户在"活动"和"来源"视图之间切换，并查看研究过程中引用的所有来源。

具体要求：
1. 使用 Shadcn UI 的 Tabs 组件实现标签系统：
   - 创建"活动"和"来源"两个标签
   - 默认选择"活动"标签
   - 标签标题应清晰表示内容

2. 实现来源列表视图：
   - 从 Zustand store 获取来源数组
   - 显示每个来源的标题（使用域名作为标题）
   - 将每个来源设置为可点击链接，打开原始 URL
   - 使用适当的样式区分链接

3. 仅在有来源可显示时才显示"来源"标签

请更新 ResearchActivities.tsx 文件，添加这些标签系统和来源列表功能。
```

**测试方法：**

- 测试标签切换功能
- 验证来源链接是否正确可点击
- 确认来源标题显示正确
- 测试"来源"标签的条件显示逻辑

### 4. 创建研究报告组件

**提示词：**

```
请为 deep-research-ai-agent 项目创建研究报告组件 (ResearchReport.tsx)，用于显示最终生成的研究报告。

具体要求：
1. 创建 src/components/ui/deep-research/ResearchReport.tsx 文件
2. 从 Zustand store 获取 report、isCompleted 和 isLoading 状态
3. 实现以下显示逻辑：
   - 当 isCompleted 为 false 时不显示任何内容
   - 当 isLoading 为 true 且 report 为空时显示加载动画
   - 当 report 有内容时显示格式化的报告

4. 使用 react-markdown 渲染报告内容：
   - 提取 report 字符串中 <report> 标签之间的内容
   - 配置适当的 Markdown 样式
   - 支持 GFM (GitHub Flavored Markdown)
   - 实现代码块语法高亮

5. 添加卡片容器和样式：
   - 适当的内边距和圆角
   - 半透明背景增强可读性
   - 响应式设计，在不同屏幕尺寸下调整宽度

请提供完整的组件代码，包括 Markdown 解析和样式。
```

**测试方法：**

- 使用示例 Markdown 测试渲染效果
- 验证条件显示逻辑是否正确
- 确认加载动画显示正确
- 测试代码块高亮功能
- 在不同屏幕尺寸下测试响应式布局

### 5. 配置 Markdown 渲染和语法高亮

**提示词：**

```
请为研究报告组件实现高级 Markdown 渲染和语法高亮功能，确保研究报告以优美、易读的格式呈现。

具体要求：
1. 配置 react-markdown 以支持多种 Markdown 特性：
   - 标题、段落、列表、表格
   - 粗体、斜体、引用、链接
   - 代码块和行内代码

2. 添加 remark-gfm 插件以支持 GitHub 风格的 Markdown：
   - 表格
   - 任务列表
   - 删除线
   - 自动链接

3. 使用 react-syntax-highlighter 实现代码块语法高亮：
   - 配置漂亮的代码高亮主题（推荐 nightOwl 主题）
   - 支持多种编程语言
   - 处理语言标识解析

4. 自定义 Markdown 组件样式：
   - 为标题添加适当的字体大小和间距
   - 为代码块添加圆角和背景
   - 为表格添加边框和条纹行
   - 为引用添加左侧边框和背景色

请更新 ResearchReport.tsx 文件，增强 Markdown 渲染功能。
```

**测试方法：**

- 使用包含多种 Markdown 元素的示例报告测试渲染
- 验证不同编程语言的代码高亮效果
- 确认表格、列表等复杂元素渲染正确
- 检查自定义样式是否正确应用

### 6. 添加报告下载功能

**提示词：**

```
请为研究报告组件添加下载功能，允许用户将生成的研究报告保存为 Markdown 文件。

具体要求：
1. 更新 ResearchReport.tsx 文件：
   - 添加下载按钮，位于报告右上角
   - 实现 handleMarkdownDownload 函数，将报告内容保存为 .md 文件
   - 使用研究主题作为文件名（格式："{topic}-research-report.md"）
   - 为下载按钮添加图标和提示文本

2. 下载功能实现：
   - 从报告内容中提取 <report> 标签之间的纯 Markdown
   - 创建 Blob 对象，配置为文本/markdown 类型
   - 使用 URL.createObjectURL 生成下载链接
   - 创建临时 <a> 元素并触发下载
   - 下载完成后清理资源（revoke object URL）

请提供完整的下载功能代码，并确保它能与现有组件无缝集成。
```

**测试方法：**

- 测试下载按钮的点击事件
- 验证下载的文件内容是否正确
- 确认文件名格式是否符合要求
- 检查资源清理是否正常工作

## 总结与下一步

完成上述步骤后，你应该已经实现了项目的研究活动跟踪和报告展示组件，这些组件为用户提供了研究过程的实时可视化和最终报告的美观呈现。

确保所有测试都通过后，再继续下一阶段的开发。

下一步：前往 [流式响应与实时更新](./09-流式响应与实时更新.md) 深入了解如何实现前后端的实时数据流。
